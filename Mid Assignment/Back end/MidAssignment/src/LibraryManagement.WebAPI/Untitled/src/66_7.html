<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>F:\NashTech\MidAssignment\tests\LibraryManagement.WebAPI Tests\Controllers\CategoryControllerTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Security.Claims;
using LibraryManagement.Application.DTOs.CategoryDTOs;
using LibraryManagement.Application.Interfaces.Services;
using LibraryManagement.WebAPI.Controllers;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Moq;

namespace LibraryManagement.WebAPI_Tests.Controllers;

public class CategoryControllerTests
{
    private Mock&lt;ICategoryService&gt; _mockCategoryService;
    private CategoryController _controller;

    [SetUp]
    public void Setup()
    {
        _mockCategoryService = new Mock&lt;ICategoryService&gt;();
        _controller = new CategoryController(_mockCategoryService.Object);
    }

    [Test]
    public async Task GetAllCategoryAsync_CategoriesExist_ReturnsOkResult()
    {

        // Act
        var result = await _controller.GetAllCategoryAsync(1, 10, &quot;&quot;);

        // Assert
        Assert.IsInstanceOf&lt;OkObjectResult&gt;(result);
    }

    [Test]
    public async Task GetBookById_CategoryExists_ReturnsOkResult()
    {
        // Arrange
        var categoryResponse = new CategoryResponse();
        _mockCategoryService.Setup(service =&gt; service.GetCategoryByIdAsync(It.IsAny&lt;Guid&gt;()))
            .ReturnsAsync(categoryResponse);
        
        // Act
        var result = await _controller.GetBookById(Guid.NewGuid());

        // Assert
        Assert.IsInstanceOf&lt;OkObjectResult&gt;(result);
    }

    [Test]
    public async Task CreateBookAsync_ValidRequest_ReturnsCreatedAtActionResult()
    {
        // Arrange
        var categoryRequest = new CategoryRequest();
        _mockCategoryService.Setup(service =&gt; service.CreateCategoryAsync(categoryRequest, It.IsAny&lt;string&gt;()))
            .ReturnsAsync(new CategoryResponse());
        // Create a ClaimsPrincipal
        var claims = new List&lt;Claim&gt; { new(ClaimTypes.Name, &quot;test user&quot;) };
        var identity = new ClaimsIdentity(claims);
        var principal = new ClaimsPrincipal(identity);

        // Assign it to the User property of the controller&#39;s ControllerContext
        _controller.ControllerContext = new ControllerContext
        {
            HttpContext = new DefaultHttpContext { User = principal }
        };

        // Act
        var result = await _controller.CreateBookAsync(categoryRequest);

        // Assert
        Assert.IsInstanceOf&lt;CreatedAtActionResult&gt;(result);
    }

    [Test]
    public async Task UpdateBookAsync_CategoryExists_ReturnsOkResult()
    {
        // Arrange
        var categoryRequest = new CategoryRequest();
        _mockCategoryService.Setup(service =&gt;
                service.UpdateCategoryAsync(It.IsAny&lt;Guid&gt;(), categoryRequest, It.IsAny&lt;string&gt;()))
            .ReturnsAsync(new CategoryResponse());
        
        var claims = new List&lt;Claim&gt; { new(ClaimTypes.Name, &quot;test user&quot;) };
        var identity = new ClaimsIdentity(claims);
        var principal = new ClaimsPrincipal(identity);

        _controller.ControllerContext = new ControllerContext
        {
            HttpContext = new DefaultHttpContext { User = principal }
        };
        var result = await _controller.UpdateBookAsync(Guid.NewGuid(), categoryRequest);

        Assert.IsInstanceOf&lt;OkObjectResult&gt;(result);
        Assert.IsNotNull(result);
    }
    
    

    [Test]
    public async Task DeleteBookAsync_CategoryExists_ReturnsNoContentResult()
    {
        var claims = new List&lt;Claim&gt; { new(ClaimTypes.Name, &quot;test user&quot;) };
        var identity = new ClaimsIdentity(claims);
        var principal = new ClaimsPrincipal(identity);
        _controller.ControllerContext = new ControllerContext
        {
            HttpContext = new DefaultHttpContext { User = principal }
        };

        var result = await _controller.DeleteBookAsync(Guid.NewGuid());

        Assert.IsInstanceOf&lt;NoContentResult&gt;(result);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,5,18,6,1],[19,9,19,61,1],[20,9,20,75,1],[21,5,21,6,1],[25,5,25,6,1],[28,9,28,71,1],[31,9,31,53,1],[32,5,32,6,1],[36,5,36,6,1],[38,9,38,55,1],[39,9,40,45,1],[43,9,43,68,1],[46,9,46,53,1],[47,5,47,6,1],[51,5,51,6,1],[53,9,53,53,1],[54,9,55,51,1],[57,9,57,76,1],[58,9,58,51,1],[59,9,59,55,1],[62,9,65,11,1],[68,9,68,73,1],[71,9,71,60,1],[72,5,72,6,1],[76,5,76,6,1],[78,9,78,53,1],[79,9,81,51,1],[83,9,83,76,1],[84,9,84,51,1],[85,9,85,55,1],[87,9,90,11,1],[91,9,91,89,1],[93,9,93,53,1],[94,9,94,34,1],[95,5,95,6,1],[101,5,101,6,1],[102,9,102,76,1],[103,9,103,51,1],[104,9,104,55,1],[105,9,108,11,1],[110,9,110,72,1],[112,9,112,54,1],[113,5,113,6,1]]);
    </script>
  </body>
</html>